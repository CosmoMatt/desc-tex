# Install latex, and the various packages used by the start_paper Makefile:
before_install:
  - sudo apt-get -qq update
  - sudo apt-get install -y gsl-bin libgsl0-dev
  - sudo apt-get install latexmk
  - sudo apt-get install latex-xcolor
addons:
    apt:
        packages:
            - texlive-generic-recommended
            - texlive-latex-recommended
            - texlive-latex-extra
            - texlive-fonts-recommended
            - texlive-fonts-extra
            - texlive-publishers
install:

# Now make the PDF. Note that `make -C` would not work - the PDF product somehow doesn't get saved.
# Also note how the product is moved to the top level, ready for deployment.
script:
    - cd doc/0000-start_paper ; make ; cd - ; cp doc/0000-start_paper.pdf .

# Finally, force-push the PDF to an otherwise empty "pdf" branch:
after_success: |
    if [ -n "$GITHUB_API_KEY" ]; then
        git checkout --orphan pdf
        git rm -rf .
        git add -f 0000-start_paper.pdf
        git -c user.name='travis' -c user.email='travis' commit -m init
        git push -q -f https://drphilmarshall:$GITHUB_API_KEY@github.com/DarkEnergyScienceCollaboration/start_paper pdf
    fi
